{% extends "base.html" %}
{% block content %}

{% set t = 'hu' if lang=='hu' else 'en' %}

<div class="row g-4">

    <!-- POSTER -->
    <div class="col-md-4 text-center">
        {% if poster %}
        <img src="{{ poster }}" alt="{{ movie.title }}"
             class="img-fluid rounded shadow-lg movie-detail-poster">
        {% else %}
        <div class="bg-secondary text-white py-5 rounded">
            No Image
        </div>
        {% endif %}
    </div>

    <!-- MOVIE INFO -->
    <div class="col-md-8">

        <h2 class="fw-bold mb-3">{{ movie.title }}</h2>

        <!-- RATING -->
        <p class="mb-1 text-muted">
            ⭐ {{ movie.vote_average }}/10  
            <span class="ms-2">
                {{ movie.vote_count }} {{ 'szavazat' if t=='hu' else 'votes' }}
            </span>
        </p>

        <p><strong>{{ 'Megjelenés dátuma' if t=='hu' else 'Release date' }}:</strong>
            {{ movie.release_date }}
        </p>

        <p class="text-muted">{{ movie.overview }}</p>

        <hr>

        <!-- USER RATING -->
        {% if current_user.is_authenticated %}
        <h5 class="fw-bold mt-4">
            {{ 'Értékelésem' if t=='hu' else 'My Rating' }}
        </h5>

        <!-- Rating form -->
        <form action="{{ url_for('user.rate_movie', movie_id=movie.id) }}" method="POST" class="d-flex align-items-center gap-2">

            <select name="rating" class="form-select w-auto">
                {% for i in range(1,11) %}
                <option value="{{ i }}" {% if user_rating==i %}selected{% endif %}>
                    {{ i }}
                </option>
                {% endfor %}
            </select>

            <button class="btn btn-dark">
                {{ 'Mentés' if t=='hu' else 'Save' }}
            </button>

            {% if user_rating %}
            <a href="{{ url_for('user.remove_rating', movie_id=movie.id) }}"
               class="btn btn-outline-danger">
                {{ 'Törlés' if t=='hu' else 'Remove' }}
            </a>
            {% endif %}
        </form>
        {% endif %}


        <!-- FAVORITES -->
        <div class="mt-4">
            {% if current_user.is_authenticated %}
                {% if is_favorite %}
                    <a href="{{ url_for('user.remove_favorite', movie_id=movie.id) }}"
                       class="btn btn-warning">
                        ⭐ {{ 'Kedvencekből törlés' if t=='hu' else 'Remove from favorites' }}
                    </a>
                {% else %}
                    <a href="{{ url_for('user.add_favorite', movie_id=movie.id) }}"
                       class="btn btn-success">
                        ⭐ {{ 'Hozzáadás a kedvencekhez' if t=='hu' else 'Add to favorites' }}
                    </a>
                {% endif %}
            {% endif %}
        </div>

    </div>
</div>

<style>
/* Poster styling */
.movie-detail-poster {
    border-radius: 12px;
    max-height: 550px;
    object-fit: cover;
}
</style>

{% endblock %}